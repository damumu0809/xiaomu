# 使用Node.js完成前后端及数据库的数据交互

这小节的主要目的有两个：

+ 完成研究开发与实践的作业
+ 熟悉使用Node.js进行Web开发

首先表达一下我的许些歉意，因为一直给你安利Node.js，我一直不愿学JSP，一直没给你讲清楚怎么使用Node.js，没给你讲清楚Express，造成你的研究开发与实践作业现在都还没完成😥

所以现在结合实际情况，为了能让你快速从JSP开发模式切换到Node.js开发模式，我已经将你写好的JSP代码移植到了Node.js项目中。


## 一. 准备知识

对于这部分，有些了解的，就可以直接忽略。不了解的，就可以看看。

### 1. 目录结构

移植后的项目目录为用户主目录下的 `homework4` 目录。Node.js的项目不必放在特定的目录（这里特定目录，指的是类似于Tomcat的webapp目录），我们可以把Node.js的项目放在任何目录，然
后通过 `node app.js` 命令来启动我们的应用即可。

`homework4`的目录结构大概如下：

```
--- bin // 可执行文件
--- node_modules // node.js 依赖包
--- public // 静态文件（CSS/JS/Images）目录
--- routes // 路由目录
--- views // 模板文件目录
--- app.js  // 入口文件
--- package.json  // 项目描述文件，里面有我们所需要的依赖包
--- README.md
```

你的 `index.html` 文件，移植后，就是 `views` 目录下的 `index.ejs` 文件。


你的 `getMenu.jsp`，在本项目中，就是 `routes/index.js` 文件。这个文件是用Node.js写的。


你的模板的所有 `*.html` 文件都在 `views` 目录里面，且后缀名都改为了 `.ejs`。因为我们使用的是 EJS 模板引擎，这样我们就可以在 HTML 中写 JS。

你的模板的所有静态文件，如 CSS、JS 和图片，都在 `public` 目录下。


### 2. 在浏览器中访问网站

网站本质上也是一个应用程序。Node.js的网站，就像是一个桌面应用，需要通过 `node app.js` 来启动网站，然后才能在浏览器中通过 `localhost:3000` 来访问我们的网站。

目前访问可能报错，因为数据库配置可能没有修改，同时之前的代码可能有语法错误。

### 3. `index.html` 即 `index.ejs`

前面提到过，你的 `index.html` 文件，移植后，就是 `views` 目录下的 `index.ejs` 文件。

你的 JS 代码都是以内嵌的方式，写在 `index.html` (这里为 `index.ejs`)中，这个我没有修改。可以这么做，以后更推荐的方式是，JavaScript 都写在单独的文件中，然后通过 `<script>` 标签引入。

现在可以不用把 JavaScript 分离，你可以继续在 `index.ejs` 里面修改你的 JS。

**有一点需要注意的是，之前想后台发送 post 请求，路径是 `getMenu.jsp`，而现在就应该是 `/menu` 了。具体见下一小节。**

### 4. `getMenu.jsp` 即 `routes/index.js`

这个文件的主要作用是路由的控制，以及逻辑的处理。

**什么是路由？**

先来回想一下，之前我们访问某个网页都是通过 `localhost:port/路径` 的方式来访问的。一旦文件名变了，我们的路径也就变了。而且这样扩展性太低，我们必须得清楚记得每个文件的名词，以及每个文件是干嘛的。

所以就有了路由的概念。再来回想一下 URL 的组成：`<scheme>://<host>:<port>/<url-path>`。路由就相当于是 `<url-path>` 部分。我们要自己写代码，来定义 `<url-path>` 的名词，并将其定位到具体的文件。这就是路由的控制。索性，`Express` 这个 Web 框架已经帮我们做好了大部分路由处理的工作，我们只需要按照它给的方法，来定义不同的路由就行了。

**路由实例**

`app.get('/')` 是监听 '/' 这个路由的 GET 请求。这样，我们就可以通过 `localhost:3000/` 来访问首页。

`app.post('/menu')` 是监听的 `/menu` 路由的 POST 请求。这样，我们就可以在 `index.ejs` 里面使用 `$.post('/menu')` 来请求数据。


## 二. 实战

你要修改的文件主要有三个。

### app.js

主要修改里面的数据库配置。我已经给你改好了。

### views/index.ejs

前端模板文件。这个文件中的 JS 目前还有些问题，需要你再细心修改一下。

### routes/index.js

这主要是修改 `app.post('/menu')` 这个路由里面的逻辑，让它来为你的前端（`index.ejs`）提供数据。

这个文件里面，我写了很多注释，先看看能不能看懂吧。

## 三. 写在最后

初步上手，你才学几十分钟不到。可能是会比较折腾。

不过我相信，等你稍微了解了以后，你就会知道用 Node.js + Express.js 开发网站是有多么方便了！






